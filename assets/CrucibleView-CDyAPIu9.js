import{d as $,r as h,o as d,c as b,a as e,F as y,b as g,t as v,_ as S,e as P,f as L,g as T,n as C,h as R,i as w,w as M,M as I,T as A,I as B,D as E,H as F,j as k,k as W,l as q}from"./index-BbJPU30i.js";const x="/data/crucibleStandings.json";async function N(){return fetch(x).then(a=>a.json()).then(a=>{for(let o=0;o<a.CruciblePlayers.length;o++){var t=a.CruciblePlayers[o].wins,p=a.CruciblePlayers[o].wins+a.CruciblePlayers[o].losses;a.CruciblePlayers[o].games=p;var m=V(t,p);a.CruciblePlayers[o].wr=m;var s=a.CruciblePlayers[o].opponentWins,n=a.CruciblePlayers[o].opponentLoss;a.CruciblePlayers[o].recordStrength=s/(n+s)}return a.CruciblePlayers.sort((o,c)=>c.wins!==o.wins?c.wins-o.wins:c.recordStrength-o.recordStrength).forEach((o,c)=>o.standing=c+1),a})}function V(a,t){if(a===0||t===0)return"0%";{var p=a/t*100;const s=`${Math.round(p)}%`;return String(s)}}const H={class:"table-container"},z={class:"table-wrapper"},G={class:"horizontal-lines-table"},K=$({__name:"CrucibleTable",props:{CruciblePlayers:{}},setup(a){const t=h(["Standing","Player","Wins","Losses","Games","WR"]),p=h(["standing","name","wins","losses","games","wr"]);return(m,s)=>(d(),b("div",H,[e("div",z,[s[0]||(s[0]=e("h2",{class:"redmanes-header"},"The Crucible",-1)),e("table",G,[e("thead",null,[e("tr",null,[(d(!0),b(y,null,g(t.value,(n,o)=>(d(),b("th",{key:"table1-header-"+o},v(n),1))),128))])]),e("tbody",null,[(d(!0),b(y,null,g(m.CruciblePlayers,(n,o)=>(d(),b("tr",{key:"table1-row-rednames"+o},[(d(!0),b(y,null,g(p.value,c=>(d(),b("td",null,v(n[c]),1))),256))]))),128))])])])]))}}),O=S(K,[["__scopeId","data-v-7d1f5af4"]]),U=async()=>{const a="/data/normalizedResults.json";try{const t=await fetch(a);if(!t.ok)throw new Error(`Failed to fetch stats: ${t.statusText}`);const p=await t.json();if(!p.crucible)throw new Error("Crucible data not found.");return{matches:p.crucible.flatMap(s=>s.matches.map(n=>({...n,week:s.week})))}}catch(t){throw console.error(t),new Error("Failed to load Crucible stats. Please try again later.")}},Y={class:"container"},J={key:0,class:"error"},Q={class:"table-container"},X={class:"results-table"},Z={class:"table-caption"},j={class:"week-button-group"},D=["onClick"],ee={rowspan:2},te={rowspan:2},ae={rowspan:2},se=["src"],le=$({__name:"CrucibleResultsTable",setup(a){const t=h({matches:[]}),p=h(!1),m=h(void 0),s=h(null),n=h(null),o=r=>{m.value=r,p.value=!0},c=r=>r==="Bingo"||r==="Majority"?"highlight-green":r==="Lost"?"highlight-red":"",i=P(()=>{const r=new Set(t.value.matches.map(_=>_.week));return Array.from(r).sort((_,u)=>_-u)}),l=P(()=>n.value!==null?t.value.matches.filter(r=>r.week===n.value):t.value.matches);return L(async()=>{try{t.value=await U();const r=i.value;r.length>0&&(n.value=r[2])}catch(r){s.value=r.message}}),(r,_)=>(d(),b("div",Y,[s.value?(d(),b("div",J,v(s.value),1)):T("",!0),e("div",Q,[e("table",X,[e("caption",Z,[e("div",j,[(d(!0),b(y,null,g(i.value,u=>(d(),b("button",{key:u,class:C(["week-button",{active:n.value===u}]),onClick:f=>n.value=u}," Week "+v(u),11,D))),128)),e("button",{class:C(["week-button",{active:n.value===null}]),onClick:_[0]||(_[0]=u=>n.value=null)}," All Weeks ",2)])]),_[2]||(_[2]=e("thead",null,[e("tr",null,[e("th",null,"Game"),e("th",null,"Player"),e("th",null,"Score"),e("th",null,"Win Condition"),e("th",null,"Match Time"),e("th",null,"Board")])],-1)),e("tbody",null,[(d(!0),b(y,null,g(l.value,(u,f)=>(d(),b(y,{key:f},[e("tr",{class:C({"new-game-row":f===0||l.value[f-1].gameId!==u.gameId})},[e("td",ee,v(u.gameId),1),e("td",{class:C(c(u.player1.outcome))},v(u.player1.name),3),e("td",{class:C(c(u.player1.outcome))},v(u.player1.score),3),e("td",{class:C(c(u.player1.outcome))},v(u.player1.outcome),3),e("td",te,v(u.matchTime),1),e("td",ae,[u.imageLink?(d(),R(B,{key:0,onClick:Ce=>o(u.imageLink),class:"marika-eye"},null,8,["onClick"])):T("",!0)])],2),e("tr",null,[e("td",{class:C(c(u.player2.outcome))},v(u.player2.name),3),e("td",{class:C(c(u.player2.outcome))},v(u.player2.score),3),e("td",{class:C(c(u.player2.outcome))},v(u.player2.outcome),3)])],64))),128))])])]),(d(),R(A,{to:"body"},[w(I,{show:p.value,onClose:_[1]||(_[1]=u=>p.value=!1)},{default:M(()=>[e("img",{src:m.value,alt:"Board Image",style:{"max-width":"100%",height:"auto"}},null,8,se)]),_:1},8,["show"])]))]))}}),re=S(le,[["__scopeId","data-v-48458b96"]]),ne=async()=>{const a="/data/crucibleSquareStats.json";try{const t=await fetch(a);if(!t.ok)throw new Error(`Failed to fetch challenge records: ${t.statusText}`);const p=await t.json();return{records:Object.entries(p).map(([s,n])=>({name:s,completed:n.Completed,appeared:n.Appeared,ratio:n.Ratio,appearance:n.Appearance}))}}catch(t){throw console.error(t),new Error("Failed to load challenge records. Please try again later.")}},oe={class:"container"},ce={key:0,class:"error"},ue={key:1,class:"table-container"},ie={class:"results-table"},de={class:"left-column"},pe=$({__name:"CrucibleSquareStatsTable",setup(a){const t=h({records:[]}),p=h(null),m=h("name"),s=h("asc");L(async()=>{let c=37;try{const i=await ne();t.value.records=i.records.map(l=>{const r=l.appeared>0?Number((l.completed/l.appeared*100).toFixed(0)):0,_=Number((l.appeared/c*100).toFixed(0));return{...l,ratio:r,appearance:_}}),t.value.records.sort((l,r)=>l.name.localeCompare(r.name))}catch(i){p.value=i.message}});const n=c=>{m.value===c?s.value=s.value==="asc"?"desc":"asc":(m.value=c,s.value="desc"),t.value.records.sort((i,l)=>{let r=parseFloat(i[c]),_=parseFloat(l[c]);return s.value==="asc"?r-_:_-r})},o=()=>{m.value==="name"?s.value=s.value==="asc"?"desc":"asc":(m.value="name",s.value="desc"),t.value.records.sort((c,i)=>{const l=c.name.toLowerCase(),r=i.name.toLowerCase();return s.value==="asc"?l.localeCompare(r):r.localeCompare(l)})};return(c,i)=>(d(),b("div",oe,[p.value?(d(),b("div",ce,v(p.value),1)):(d(),b("div",ue,[e("table",ie,[e("thead",null,[e("tr",null,[e("th",{onClick:o,class:"sortable"},"Square Name ⬍"),e("th",{onClick:i[0]||(i[0]=l=>n("completed")),class:"sortable"},"Completed ⬍"),e("th",{onClick:i[1]||(i[1]=l=>n("appeared")),class:"sortable"},"Appeared ⬍"),e("th",{onClick:i[2]||(i[2]=l=>n("ratio")),class:"sortable"},"Completion % ⬍"),e("th",{onClick:i[3]||(i[3]=l=>n("appearance")),class:"sortable"},"Appearance % ⬍")])]),e("tbody",null,[(d(!0),b(y,null,g(t.value.records,(l,r)=>(d(),b("tr",{key:r},[e("td",de,v(l.name),1),e("td",null,v(l.completed),1),e("td",null,v(l.appeared),1),e("td",null,v(l.ratio)+"%",1),e("td",null,v(l.appearance)+"%",1)]))),128))])])]))]))}}),be=S(pe,[["__scopeId","data-v-c3ab4500"]]),ve={name:"CrucibleView",components:{CrucibleTable:O,Divider:E,HeaderView:F,CrucibleResultsTable:re,CrucibleSquareStatsTable:be},data(){return{table:{cruciblePlayers:{CruciblePlayers:[]}}}},created(){N().then(a=>{console.log(a),this.table.cruciblePlayers=a})}},me={class:"main-container"},_e={class:"table-container"};function he(a,t,p,m,s,n){const o=k("HeaderView"),c=k("CrucibleTable"),i=k("CrucibleResultsTable"),l=k("CrucibleSquareStatsTable");return d(),b(y,null,[w(o),e("div",me,[t[2]||(t[2]=e("div",{class:"top-image-container"},[e("img",{src:W,alt:"Stars Ending",class:"grayscale-image"}),e("img",{src:q,alt:"Logo",class:"logo-image"})],-1)),t[3]||(t[3]=e("h1",{class:"header"},"The Crucible Standings",-1)),e("div",_e,[w(c,{CruciblePlayers:s.table.cruciblePlayers.CruciblePlayers},null,8,["CruciblePlayers"])]),e("div",null,[t[0]||(t[0]=e("h1",null,"Crucible Results",-1)),w(i)]),e("div",null,[t[1]||(t[1]=e("h1",null,"Crucible Square Stats",-1)),w(l)])])],64)}const ge=S(ve,[["render",he],["__scopeId","data-v-65b3f502"]]);export{ge as default};
